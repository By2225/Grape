#!/bin/bash

GRAPE="../src/grape.native"

COMPARE() {
    generatedfiles="$generatedfiles $3"
    cmp $1 $2 || {
        SignalError "$1 differs"
        echo "FAILED $1 difffers from $2" 1>&2
    }
}

RUN() {
    echo $* 1>&2
    eval $* || {
        SignalError "$1 failed on $*"
        return 1;
    }
}

files="../tests/hello-world.grp"
ref="../tests/hello-world.grp.out"


for file in $files
do
    RUN $GRAPE $file ">" "hello-world.ll" &&
    RUN "lli" "hello-world.ll" ">"  "test.out" &&
    COMPARE "test.out" "hello-world.diff"
    
done
exit
